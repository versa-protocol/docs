---
title: "Receiving a Receipt"
---

# Receiving a Receipt

Receivers are typically financial institutions or spend management apps. As a receiver, you'll collect and display your customers' receipts. Receivers display receipts to help customers manage spend, reclaim VAT, comply with audits, etc.

To onboard as a receiver, you'll need to:

1. **[Set up your client](#client-configuration)**
2. **[Register your customers](#customer-registration)**
3. **[Collect receipts](#collecting-receipts)**
4. **[Render receipts](#rendering-receipts)**

## Client Configuration

First, you’ll need to [create an account](https://app.versa.org) on Versa.

Just as on the sending end, receivers need to choose how they'd like to receive receipts:

1. Via a [custodial configuration](#custodial-configuration). With this arrangement, you'll receive webhook events containing the receipt json at the url you specify. Versa handles the decryption.
2. Via a [self-hosted configuration](#self-hosted-configuration). With this arrangement, the receiver collects and decrypts receipts directly. You'll still receive webhook events, but the webhook body will include an encrypted receipt and nonce, and you will be responsible for checking out the key from the Versa Registry and decrypting the receipt.

The custodial configuration is typically easier for developers to implement quicky. The self-hosted configuration, on the other hand, removes the need to trust a third-party (Versa) with the receipt data. At any point you can 'eject' from a custodial to a self-hosted configuration. Most developers start with a custodial configuration during development, then switch to self-hosted.

## Customer Registration

Before you start receiving receipts, you'll need register your customers who have granted you access. This matching is done via your customers' email domain.

Typically, you’ll do a batch registration when onboarding onto Versa, and from that point onwards, you’ll manage your list of authorized customers, registering and de-registering handles.

Registering and de-registering customers is typically handled via API, but the Versa web app also includes a user interface to add and remove customers.

To register a handle:

```bash
curl --request POST \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "email_domain",
    "handle": "acme.com"
  }'
```

| Field         | Type     | Description            |
| ------------- | -------- | ---------------------- |
| `handle_type` | `enum`   | One of `email_domain`. |
| `handle`      | `string` | The handle value.      |

> [!NOTE]
> Currently, the only valid `handle_type` is `email_domain`, however in the future we expect to add other types.

When you lose a customer, you will de-register them. To remove a registered profile:

```bash
curl --request DELETE \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "email_domain",
    "handle": "acme.com"
  }'
```

## Collecting Receipts

Once your customers are registered, receipts that match your customer handles will start hitting the webhook address you've specified in your client. The contents of that webhook depend on whether you've configured a custodial or self-hosted client.

### Custodial Configuration

If you've set up a custodial client, you will receive decrypted receipt objects at your webhook address. You're free to store those receipts and [render them](#rendering-receipts) within your app.

### Self-hosted Configuration

If you've set up a self-hosted client, you'll recieve encrypted receipt objects. Your responsiblities include:

1. [Receive the encrypted receipt](#1-receive-the-encrypted-receipt)
2. [Exchange the id for a key, via the registry](#2-get-the-key)
3. [Decrypt the receipt](#3-decrypt-the-receipt)

#### 1. Receive the encrypted receipt

An example payload that you will receive at your registered address, from the sender (merchant).

```json
{
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "nonce": [...],
  "encrypted": [...]
}
```

#### 2. Get the key

Take the receipt id, and exchange it for a key.

```bash
curl --request POST \
  --url 'https://registry.versa.org/checkout' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
    "schema_version": "1.0.0"
  }'
```

| Field            | Type     | Description                                                                |
| ---------------- | -------- | -------------------------------------------------------------------------- |
| `receipt_id`     | `string` | The id of the specific receipt being received.                             |
| `schema_version` | `string` | The latest schema version of the receipt that you are prepared to receive. |

Example response:

```json
{
  "key": [...],
  "sender": {
    "name": "Platform Co.",
    "brand_color": "f0C14B",
    "logo": "https://static.platform.co/image_url.png",
    "website": "platform.co"
  }
}
```

The `sender` is a [merchant object](https://docs.versa.org/receipt#merchant).

#### 3. Decrypt the receipt

Receipts are decrypted with the AES 256 encryption algorithm, using the registry-provided key and a unique nonce provided by the sender.

## Rendering Receipts

Once decrypted, the receiver can either store and render the receipt as you see fit, or you can use a Versa frontend library to render the object.
If you use React, you can use the [@versaprotocol/react](https://www.npmjs.com/package/@versaprotocol/react) package.

```jsx
import { ReceiptDisplay } from "@versaprotocol/react";

export const YourReceiptWrapper = ({
  senderProfileReturnedByRegistry,
  decryptedReceipt,
}) => {
  return (
    <ReceiptDisplay
      merchant={senderProfileReturnedByRegistry}
      receipt={decryptedReceipt}
    />
  );
};
```
