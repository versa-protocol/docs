---
title: "Receiving a Receipt"
---

# Receiving a Receipt

Receivers are typically financial institutions or spend management apps. As a receiver, you'll collect and display your customers' receipts.

To onboard as a receiver, you'll need to:

1. Set up your client
2. Register customers
3. Collect receipts
4. Render receipts

## Set up your client

First, you’ll need to [create an account](https://app.versa.org) on Versa.

Just as on the sending end, receivers need to pick how they'd like to receive receipts:

1. Via a custodial configuration. With this arrangement, you'll receive webhook events containing the receipt json at the url you specify.
2. Via a self-hosted configuration. With this arrangement, the receiver collects and decrypts receipts directly. The webhook body will include an encrypted receipt and nonce, and you will be responsible for checking out the key from the Versa Registry and decrypting the receipt.

The custodial configuration is typically easier. The self-hosted configuration, on the other hand, removes the need to trust a third-party (Versa) with the receipt data. At any point you can 'eject' from a custodial to a self-hosted configuration. Most developers start with a custodial configuration during development, then switch to self-hosted.

## Register customers

Before you start receiving specific customers' receipts, you'll need them to authorize access.

Now that your account is configured, you’ll need to register the customers for whom you’re authorized to receive receipts. To register a customer, you will need to post their work email domain.

Typically, you’ll do a batch registration when onboarding onto Versa, and from that point onwards, you’ll manage your list of authorized customers, registering and de-registering handles.

To register a handle:

```bash
curl --request POST \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "email_domain",
    "handle": "acme.com"
  }'
```

| Field         | Type     | Description            |
| ------------- | -------- | ---------------------- |
| `handle_type` | `enum`   | One of `email_domain`. |
| `handle`      | `string` | The handle value.      |

> [!NOTE]
> Currently, the only valid `handle_type` is `email_domain`, however in the future we expect to add other types.

To remove a registered profile:

```bash
curl --request DELETE \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "email_domain",
    "handle": "acme.com"
  }'
```

## Collect receipts

### Custodial mode

If you've set up your client in custodial mode,

### Self-hosted configuration

1. Receive the encrypted receipt.
2. Exchange the id for a key, via the registry.
3. Decrypt and render the receipt.

#### Receive the encrypted receipt

An example payload that you will receive at your registered address, from the sender (merchant).

```json
{
  "receipt_hash": 175932758392347,
  "nonce": [...],
  "encrypted": [...]
}
```

#### Exchange the hash for a key via the registry

```bash
curl --request POST \
  --url 'https://registry.versa.org/checkout' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 175932758392347,
    "schema_version": "1.0.0"
  }'
```

Example response:

```json
{
  "key": [...],
  "sender": {
    "name": "Platform Co.",
    "brand_color": "f0C14B",
    "logo": "https://static.platform.co/image_url.png",
    "website": "platform.co"
  }
}
```

The `sender` is a [merchant object](https://docs.versa.org/receipt#merchant).

#### Decrypt the receipt

Receipts are decrypted with the AES 256 encryption algorithm, using the registry-provided key and a unique nonce provided by the sender.

## Render receipts

Once decrypted, the receiver can either store and render the receipt as they see fit, or they can use a Versa frontend library to render the object.
For example, if you use React, you can use the [@versaprotocol/react](https://www.npmjs.com/package/@versaprotocol/react) package

```jsx
import { ReceiptDisplay } from "@versaprotocol/react";

export const YourReceiptWrapper = ({
  senderProfileReturnedByRegistry,
  decryptedReceipt,
}) => {
  return (
    <ReceiptDisplay
      merchant={senderProfileReturnedByRegistry}
      receipt={decryptedReceipt}
    />
  );
};
```
