---
title: "Receiving a Receipt"
---

# Receiving a Receipt

Receivers are typically financial institutions or spend management apps. As a receiver, you'll collect and display your customers' receipts. Receivers display receipts to help customers manage spend, reclaim VAT, comply with audits, etc.

To onboard as a receiver, you'll need to:

1. **[Set up your client](#client-configuration)**
2. **[Register your customers](#customer-registration)**
3. **[Collect receipts](#collecting-receipts)**
4. **[Render receipts](#rendering-receipts)**

## Client Configuration

First, you’ll need to [create an account](https://app.versa.org) on Versa.

Just as on the sending end, receivers need to choose how they'd like to receive receipts:

1. Via a **[custodial configuration](#custodial-configuration)**. With this arrangement, you'll receive webhook events containing the receipt JSON at the URL you specify. Versa handles the decryption.
2. Via a **[self-hosted configuration](#self-hosted-configuration)**. With this arrangement, the receiver collects and decrypts receipts directly. You'll still receive webhook events, but the webhook body will include an encrypted receipt and nonce, and you will be responsible for checking out the key from the Versa Registry and decrypting the receipt.

The custodial configuration is typically easier for developers to implement quicky. The self-hosted configuration, on the other hand, removes the need to trust a third-party (Versa) with the receipt data. At any point you can 'eject' from a custodial to a self-hosted configuration. Most developers start with a custodial configuration during development, then switch to self-hosted.

## Customer Registration

Before you can start receiving receipts, you'll need to register the customers who have authorized you as their receipt receiver.

When you register a customer, you add their 'handle' — the identifier that Versa uses to know where to send receipts.

Typically, you’ll do a batch registration when you initially onboard to Versa, and from that point forward, you’ll manage your list of authorized customers synchronously, registering and de-registering handles as you add and remove customers.

Registering and de-registering handles is typically performed via API, but the Versa web app also includes a user interface for this action.

To register a handle via API:

```bash
curl --request POST \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "customer_email_domain",
    "handle": "acme.com"
  }'
```

| Field         | Type     | Description                     |
| ------------- | -------- | ------------------------------- |
| `handle_type` | `enum`   | One of `customer_email_domain`. |
| `handle`      | `string` | The handle value.               |

> [!NOTE]
> The only valid customer handle type at the moment is a `customer_email_domain` — in the future, we will add others.

When you lose a customer, you will de-register them. To remove a registered profile:

```bash
curl --request DELETE \
  --url 'https://registry.versa.org/handle' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "handle_type": "customer_email_domain",
    "handle": "acme.com"
  }'
```

## Collecting Receipts

Once your customers are registered with Versa, incoming receipts that those customer profiles will start hitting the webhook address you've specified in your client. The contents of this webhook request body depend on whether you've configured a custodial or self-hosted client.

### Custodial Configuration

If you've set up a custodial client, you will receive decrypted receipt objects at your webhook address. You're free to store and [render them](#rendering-receipts) these receipts within your product.

An example payload might look like this:

```json
{
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "transaction_id": "txn_5ed073abbf3a4b49a8c03191f87d8ffe",
  "receipt": {
    ...
  },
  "sender": {
    "name": "Platform Co.",
    "brand_color": "f0C14B",
    "logo": "https://static.platform.co/image_url.png",
    "website": "platform.co"
  }
}
```

### Self-Hosted Configuration

If your client is configured in 'self-hosted' mode, you'll receive encrypted receipt objects. Your responsiblities will then include:

1. **[Receive Encrypted Receipt](#1-receive-the-encrypted-receipt)**
2. **[Get the Key](#2-get-the-key)**
3. **[Decrypt Receipt](#3-decrypt-the-receipt)**

#### 1. Receive the Encrypted Receipt

An example payload that you will receive at your registered address, from the sending merchant:

```json
{
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "envelope": {
    "encrypted": [ ... ],
    "nonce": [ ... ]
  }
}
```

#### 2. Get the Key

Take the `receipt_id` you received, and exchange it for the matching `key`, via the Versa Registry.

```bash
curl --request POST \
  --url 'https://registry.versa.org/checkout' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
    "schema_version": "1.0.0"
  }'
```

| Field            | Type     | Description                                                                |
| ---------------- | -------- | -------------------------------------------------------------------------- |
| `receipt_id`     | `string` | The id of the specific receipt being received.                             |
| `schema_version` | `string` | The latest schema version of the receipt that you are prepared to receive. |

Example response:

```json
{
  "key": [...],
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "transaction_id": "txn_5ed073abbf3a4b49a8c03191f87d8ffe",
  "sender": {
    "name": "Platform Co.",
    "brand_color": "f0C14B",
    "logo": "https://static.platform.co/image_url.png",
    "website": "platform.co"
  }
}
```

The `sender` is a [merchant object](https://docs.versa.org/receipt#merchant).

#### 3. Decrypt the Receipt

Receipts are decrypted with the AES 256 encryption algorithm, using the registry-provided key and a unique nonce provided by the sender.

## Rendering Receipts

Once decrypted, you can store and render the receipt as you see fit. You can roll your own renderer, or you can use a Versa frontend library to render the receipt.
We currently offer a React [@versaprotocol/react](https://www.npmjs.com/package/@versaprotocol/react) renderer package.

```jsx
import { ReceiptDisplay } from "@versaprotocol/react";

export const YourReceiptWrapper = ({
  senderProfileReturnedByRegistry,
  decryptedReceipt,
}) => {
  return (
    <ReceiptDisplay
      merchant={senderProfileReturnedByRegistry}
      receipt={decryptedReceipt}
    />
  );
};
```

## Testing Your Integration

Once you've set up your client, you can test your integration by sending a test receipt from the Versa web app. This will send a simple receipt to your webhook address, allowing you to verify that your client is correctly receiving and processing receipts.

If you've opted for custodial hosting, you'll be able to view the sent receipt in your [Logs](https://app.versa.org/logs).

The test receipt is sent by a sandbox merchant maintained by Versa. It will be clearly marked as "[TEST]" in the sender data.

![A screenshot of a Versa Client panel, for a receiver, with a Send Test Receipt button](https://raw.githubusercontent.com/versa-protocol/docs/main/assets/send-test-receipt.png)
