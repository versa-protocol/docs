---
title: "Sending a Receipt"
---

# Sending a Receipt

Receipt senders are merchants or merchant service providers — E-commerce websites, online booking tools, hotel chains, etc. — who wish to pass receipts through to their customers.

Senders first need to pick how they'd like to send receipts:

1. Via a _custodial_ configuration: With this arrangement, sending a receipts is as simple as a standard HTTP POST request, via a RESTful API. The sender makes a single call per receipt, passing up the receipt JSON to Versa.
2. Via a _self-hosted_ configuration: With this arrangement, the sender never sends Versa the receipt. Instead, they check Versa for registered customers, and handle the encryption and peer-to-peer receipt transfer directly.

The custodial configuration is easy to get started with. THe self-hosted configuration, on the other hand, removes the need to trust a third-party with the receipt data. At any point you can 'eject' from a custodial to self-hosted configuration. Most developers take this path.

## Getting Started

Before you can send your first receipt, you’ll need to [create an account](https://app.versa.org) on Versa.

## Custodial Configuration

...

## Self-hosted Configuration

A self-hosted sending configuration involves three steps:

1. Register the transaction.
2. Encrypt the receipt.
3. Send the encrypted receipt.

### 1. Register the transaction

The only valid handle at the moment is a `customer_email_domain` — in the future, there likely will be others.

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 175932758392347,
    "schema_version": "1.0.0",
    "handles": {
      "customer_email_domain": "acme.com"
    }
  }'
```

Example response:

```json
{
  "env": "prod",
  "encryption_key": [...],
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "transaction_id": "txn_458a58b2dd7a4fe3a9ad3165a511ac2a",
  "receivers": [
    {
      "address": "https://bank.com/receipt",
      "client_id": "versa_cid_prod_9c014de1835a46de8d3e1fd54547dd29",
      "org_id": "org_39a0e09cf0a24b02ba92bf8c8369b319",
      "secret": "versa_rsk_prod_d9362d18f76845afb4c75b8388d2e549"
    },
    {
      "address": "https://expenseapp.com/receipt",
      "client_id": "versa_cid_prod_5410222b17fa4a4e865e19aebcd77cba",
      "org_id": "org_df8d2ce28f6e48afb2dfe4af0c57788f",
      "secret": "versa_rsk_prod_56781edd14ba47a4938e252b0c3932ee"
    }
  ]
}
```

### 2. Encrypt the receipt

Receipts are encrypted with the AES 256 encryption algorithm, using the registry-provided key and a unique nonce generated for each receiver.

### 3. Send the encrypted receipt

The nonce and encrypted data are sent to each receiver address, at which point they have the opportunity to check out the key from the registry, and decrypt the envelope.

```json
{
  "sender_client_id": "versa_cid_prod_3633863a5e5d417eb723124b387ec929",
  "receipt_id": "rct_5ed073abbf3a4b49a8c03191f87d8ffe",
  "envelope": {
    "encrypted": [...],
    "hash": 175932758392347,
    "nonce": [...]
  }
}
```

## Updating a Receipt

Updating a receipt, such as to include a tip, refund, or other adjustment, is no different from registering a new receipt.
The only difference is that the original transaction_id returned by the registry must be included in the updated registration request.

E.g.

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 923232454472219,
    "transaction_id": "txn_458a58b2dd7a4fe3a9ad3165a511ac2a",
    "schema_version": "1.0.0",
    "handles": {
      "customer_email_domain": "acme.com"
    }
  }'
```

This will associate the new receipt record with the original receipt's transaction record.
The transaction_id is always returned to each receiver when they check out their keys, so that they can update the receipts on their end and trigger events to their customers.

## Testing Your Integration

As a sender, you can test your integration by using test client credentials and our sandbox receiver. The sandbox receiver is a client that only accepts receipts in test,
and exposes those receipts to any authorized user via the [Sandbox Firehose](https://app.versa.org/sandbox-firehose).
**Please note that this page is accessible to any user of the Versa portal, so do not send production or sensitive data to the sandbox.**

To send data to the sandbox receiver, ensure that you use the following domain in your receipt's routing data: `sandbox-firehose.versa.org`

For example, with a fully implemented self-hosted client:

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 555232454472219,
    "schema_version": "1.0.0",
    "email_domain": "sandbox-firehose.versa.org"
  }'
```

...or if you are starting with a custodial sender:

```bash
curl --request POST \
  --url 'https://custodial.versa.org/sender/target' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
  "handles": {
    "customer_email": "thomas@sandbox-firehose.versa.org"
  },
  "receipt": {
    "version": "1.0.0",
    "header": {
      "receipt_id": "my_receipt_id",
      "currency": "usd",
      "total": 8069,
      "subtotal": 7420,
      "paid": 8069,
      "invoiced_at": 1713295619,
      "mcc": null,
      "third_party": null,
      "customer": null,
      "location": null
    },
    "itemization": {
      "general": null,
      "lodging": null,
      "ecommerce": null,
      "car_rental": null,
      "transit_route": null,
      "subscription": {
        "subscription_items": [
          {
            "subscription_type": "recurring",
            "description": "Starter monthly plan",
            "total": 7420,
            "interval": "month",
            "interval_count": 1,
            "current_period_start": 1679609767,
            "current_period_end": 1682288167,
            "quantity": 10,
            "unit_cost": 742,
            "taxes": [
              {
                "amount": 649,
                "rate": 0.0875,
                "name": "Sales Tax"
              }
            ],
            "metadata": null,
            "adjustments": null
          }
        ],
        "invoice_level_adjustments": null
      },
      "flight": null
    },
    "actions": [
      {
        "name": "Visit Versa",
        "url": "https://versa.org/"
      },
    ],
    "payments": null
  }
}'
```

After registering your test receipt (and sending the encrypted payload to the matched receiver), you can view your sent receipt using the [Sandbox Firehose](https://app.versa.org/sandbox-firehose).
