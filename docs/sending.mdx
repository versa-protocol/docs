---
title: "Sending a Receipt"
---

# Sending a Receipt

The sender is a protocol client typically operated by a merchant. The sender's responsibilities include:

1. Register the transaction.
2. Encrypt the receipt.
3. Send the encrypted receipt.

## Register the transaction

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 175932758392347,
    "protocol_version": "0.1.0",
    "email_domain": "acme.com"
  }'
```

Example response:

```json
{
  "key": [...],
  "transaction_id": "txn_458a58b2dd7a4fe3a9ad3165a511ac2a",
  "receivers": [
    { "address": "https://bank.com/receipt" },
    { "address": "https://expenseapp.com/receipt" }
  ]
}
```

## Encrypt the receipt

Receipts are encrypted with the AES 256 encryption algorithm, using the registry-provided key and a unique nonce generated for each receiver.

## Send the encrypted receipt

The nonce and encrypted data are sent to each receiver address, at which point they have the opportunity to check out the key from the registry, and decrypt the envelope.

```json
{
  "receipt_hash": 175932758392347,
  "nonce": [...],
  "encrypted": [...]
}
```

## Updating an existing receipt

Updating a receipt, such as to include a tip, refund, or other adjustment, is no different from registering a new receipt.
The only difference is that the original transaction_id returned by the registry must be included in the updated registration request.

E.g. 

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 923232454472219,
    "transaction_id": "txn_458a58b2dd7a4fe3a9ad3165a511ac2a",
    "protocol_version": "0.1.0",
    "email_domain": "acme.com"
  }'
```

This will associate the new receipt record with the original receipt's transaction record.
The transaction_id is always returned to each receiver when they check out their keys, so that they can update the receipts on their end and trigger events to their customers.

## Testing your integration

As a sender, you can test your integration by using test client credentials and our sandbox receiver. The sandbox receiver is a client that only accepts receipts in test,
and exposes those receipts to any authorized user via the [Sandbox Firehose](https://app.versa.org/sandbox-firehose).
**Please note that this page is accessible to any user of the Versa portal, so do not send production or sensitive data to the sandbox.**

To send data to the sandbox receiver, ensure that you use the following domain in your receipt's routing data: `sandbox-firehose.versa.org`

For example, with a fully implemented self-hosted client:

```bash
curl --request POST \
  --url 'https://registry.versa.org/register' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
    "receipt_hash": 555232454472219,
    "protocol_version": "1.0.0",
    "email_domain": "sandbox-firehose.versa.org"
  }'
```

...or if you are starting with a custodial sender:

```bash
curl --request POST \
  --url 'https://custodial.versa.org/sender/target' \
  --header 'Authorization: Basic <CLIENT_ID:CLIENT_SECRET>' \
  --header 'Content-Type: application/json' \
  --data '{
  "handles": {
    "customer_email": "thomas@sandbox-firehose.versa.org"
  },
  "receipt": {
    "version": "1.0.0",
    "header": {
      "receipt_id": "my_receipt_id",
      "currency": "usd",
      "total": 8069,
      "subtotal": 7420,
      "paid": 8069,
      "invoiced_at": 1713295619,
      "mcc": null,
      "third_party": null,
      "customer": null,
      "location": null
    },
    "itemization": {
      "general": null,
      "lodging": null,
      "ecommerce": null,
      "car_rental": null,
      "transit_route": null,
      "subscription": {
        "subscription_items": [
          {
            "subscription_type": "recurring",
            "description": "Starter monthly plan",
            "total": 7420,
            "interval": "month",
            "interval_count": 1,
            "current_period_start": 1679609767,
            "current_period_end": 1682288167,
            "quantity": 10,
            "unit_cost": 742,
            "taxes": [
              {
                "amount": 649,
                "rate": 0.0875,
                "name": "Sales Tax"
              }
            ],
            "metadata": null,
            "adjustments": null
          }
        ],
        "invoice_level_adjustments": null
      },
      "flight": null
    },
    "actions": [
      {
        "name": "Visit Versa",
        "url": "https://versa.org/"
      },
    ],
    "payments": null
  }
}'
```

After registering your test receipt (and sending the encrypted payload to the matched receiver), you can view your sent receipt using the [Sandbox Firehose](https://app.versa.org/sandbox-firehose).
